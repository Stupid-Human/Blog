---
layout: post

title: 网格交易介绍&表格设计

date: 2020-08-31

categories: 投资系统打造

tags: [理财]

description:   
---


[toc]

## motivation

### why

为什么需要掌握网格交易方法，按照e大的说法，资本市场整体走势就3个状态，震荡、上涨、下跌。根据《股市长线法宝》一书的数据，尽管美股两百年来股票指数长期涨幅巨大，但是聚焦到中间的10-30年，则发现可能几十年不涨。**我们做投资，要做到不预测只应对**，因此e大建议**一个成熟的投资操作体系必须要有长期策略及短期策略**，长期策略是用来赚增长+通胀的大钱，短期波段策略赚的是情绪以及波动的钱，保护心态。

### what

网格交易，或者叫波段操作，吃的就是震荡行情的利润。

### how

按照经验，可以把资产70%的仓位用来配置长线，10%-20%用来配置网格交易。网格仓位和长线仓位要分开单独配置。



## Pro

下面原汁原味的e大的网格交易策略系列文章，它们无论是从文笔还是水平来说，都属顶流，建议读几遍，我就不做任何解读了。

[波段策略.网格之一：写在前面、体系以及策略](https://mp.weixin.qq.com/s/uxktt5ZpNo03FpQQX-aG7g)

[波段策略.网格之二：网格策略基础/1.0版](https://mp.weixin.qq.com/s/-czfqGvxkDcay_tSI1jv5g)

[波段策略.网格之三：网格策略进阶/2.0版](https://mp.weixin.qq.com/s?__biz=MzIwMTIzNDMwNA==&mid=2653409191&idx=1&sn=5c305c5cf5237e8d2c8d8f7bf0320654&chksm=8d226d48ba55e45e96029083b5656d0c494a10c9c39cff79032ec0667157f36165d47be65957&scene=21#wechat_redirect)

[网格交易细节说明（2020.04.29更新）](https://mp.weixin.qq.com/s/iIOXZCZNCaWwY_PyXUkOEw)



其中，压力测试是最重要的，也就是说，极限跌幅务必得考虑好，参考文章[**长赢计划发车文章中的“预计最大跌幅”是如何得出呢？**](https://content.qieman.com/items/325)

> 极限跌幅的判断依据基本上来讲有四条，其中两条价值、一条价格、一条投资原则：
>
> 价值历史纵向：A股历史上，该指数最低估值。 这个估值包括PE、PB、PS等数据。 通过各数据与目前估值数据对比，大致得出即使出现2008年那样的金融危机，该指数从最极限估值角度讲，会有多少下跌幅度。
>
> 价值世界横向：将世界各国，尤其是美国与各指数类似的指数历史最低估值，与目前各指数估值对比，得出大致的极限下跌空间。
>
> 价格：不会死的投资品种，通常来讲，从最高点到最低点，跌幅几乎不会超过80%，尤其是各国的宽基股票指数。你在下跌80%的时候买，即使短期依然会套，中长期将会赚非常多。
>
> 风险承受能力：在正常的最大跌幅上再加一点余量，**力求让各位能尽量考虑风险多过考虑收益。 这是金融投资中非常重要的一点。**

**历史上几次最著名的暴跌**：

> 1989年底，日经225指数在连涨15年，从3700点涨到38957点后，开始暴跌，最低跌到2003年的7600点，下跌80%。 跌到只剩20%。 2000年，纳斯达克指数连涨20多年，从70多点涨到5100点后，暴跌三年，跌到1100点，下跌78%。 跌到还剩22%。 07年恒生最高31958，08年最低10676。 下跌67%，还剩33%。 再看大A。 深综指在2008年初最高到1584，最低跌到452点，下跌71%，还剩29%。 再看原油。 NY油价是2013年涨到最高112开始崩盘。 最低点是26块，下跌77%，还剩23%。 再看汇率。 英镑/美元从1980年的2.45跌到1985年的1.05，下跌幅度是57%，还剩43%。 美元/日元是从1982年的277跌到2011年的75，跌幅73%，还剩27%。 最后看白银。 之所以用白银不用黄金，是因为历史上白银价格波动远大于黄金。 白银最大一次跌幅出现在80年代，从最高点49美元跌到最低3.7，跌幅达到了92%。 这个跌幅已经超过了我们之前说的80%。 这里有两个原因，第一个原因是80年涨的太疯狂。 白银从1972年的1.7涨到1980年的49，8年时间涨了28倍。 如果从49算起，那么下跌80%应该是9.8。 如果在9.8买入，跌到3.7当然会浮亏不少，但是到2011年，即使9.8买入，也会赚400%。



## code & excel

指数估值表——来源于e大微博

![Alt](https://user-images.githubusercontent.com/35519242/116804651-f91c9500-ab52-11eb-9f23-dc0389ee595a.jpg)

![Alt](https://user-images.githubusercontent.com/35519242/116804672-28cb9d00-ab53-11eb-8c61-b43052d4e17b.png)

我准备把军工拿来试水，参考蛋卷基金的[中证军工的估值](https://danjuanapp.com/dj-valuation-table-detail/SZ399967)，军工估值已经跌落到平均值以下了，可以入手。对于极限跌幅，从e大的估值表来看，军工历史上最低估值是约2008年的19倍，现在PE估值49倍，极限跌幅可以给到60%，这就是压力测试了。

本交易设计参考e大的2.0版本，融合了**留利润、逐格加码及大中小网结合**的子策略。3.0版本可以更进一步，比如考虑趋势交易，暂时不碰了。

我用Python3写了一小段代码来辅助设计表格，其中，start、moneyEach、ratio均可修改。代码运行完后把输出结果复制粘贴到excel表格相应位置即可。

有了表格以后，添加华宝的条件交易单，



```
# 网格交易计算 

start = 0.988  # 0.988 从某个价格下跌5%时买入第一网，这个价格可以是当前价格，或者比当前价格高或者低。别在均值以上高位买入。
money = 10000 # 每份金额 
num = 0
ratio = 0.05  #小网格的大小
baseList = []
print('买入价',   '卖出价', '买入数量',  '买入金额', '卖出数量', '卖出金额',
          '本期留存数量',  '本期留存利润/盈利金额', '盈利比例')

def PRINT(lastNetCostprice, base, N, moneyEach):
    # N为radio的1、3、6、12倍
    costpriceIn = base
    costpriceOut = lastNetCostprice
    NumIn = moneyEach / costpriceIn
    NumOut = moneyEach / costpriceOut
    Numkeep = NumIn - NumOut 
    profitKeep = costpriceOut * Numkeep
    profitRatio = profitKeep / moneyEach 
    
    print('%.3f' % costpriceIn, '\t',
             '%.3f' % costpriceOut, '\t',
             '%.0f' % NumIn, '\t',
             '%.0f' % moneyEach, '\t',
             '%.0f' % NumOut, '\t',
             '%.0f' % moneyEach, '\t', 
             '%.0f' % Numkeep, '\t',
             '%.0f' % profitKeep, '\t',
             '{:.2%}'.format(profitRatio)) 

for i in range(13):
    if i != 0:
        num += 1
    base = start * (1-ratio*num)  #base为当前这一网的买入价
    baseList.append(base)
    moneyEach = money*(1+ratio*i)    # 逐格加码
    if i == 0:
        lastNetCostprice = base * (1+ratio)
    else: 
        lastNetCostprice = baseList[i-1]
    
    # 小网
    # lastNetCostprice为上一网的价格，中网、大网、超大网则不是。
    PRINT(lastNetCostprice, base, 1, moneyEach)
    
    # 中网 大网 超大网
    if num % 3 == 0 and i != 0:
        PRINT(baseList[i-3], base, 3, moneyEach)
    if num % 6 == 0 and i != 0:
        PRINT(baseList[i-6], base, 6, moneyEach)
    if num % 12 == 0 and i != 0:
        PRINT(baseList[i-12], base, 12, moneyEach)
```



**小网5%，中网15%，大网30%，超大网60%操作表**

| 种类     | 档位  | 买入价 | 卖出价  | 买入数量 | 买入金额 | 卖出数量 | 卖出金额 | 本期留存数量 | 本期留存利润/盈利金额 | 盈利比例 |
| -------- | ----- | ------ | ------- | -------- | -------- | -------- | -------- | ------------ | --------------------- | -------- |
| 小网     | 1.00  | 0.988  | 1.037   | 506.00   | 500      | 482.00   | 500.00   | 24           | 25                    | 5.00%    |
| 0.95     | 0.939 | 0.988  | 559.00  | 525      | 531.00   | 525.00   | 28       | 28           | 5.26%                 |          |
| 0.90     | 0.889 | 0.939  | 619.00  | 550      | 586.00   | 550.00   | 33       | 31           | 5.56%                 |          |
| 0.85     | 0.840 | 0.889  | 685.00  | 575      | 647.00   | 575.00   | 38       | 34           | 5.88%                 |          |
| 中网     | 0.85  | 0.840  | 0.988   | 685.00   | 575      | 582.00   | 575.00   | 103          | 101                   | 17.65%   |
| 小网     | 0.80  | 0.790  | 0.840   | 759.00   | 600      | 714.00   | 600.00   | 45           | 38                    | 6.25%    |
| 0.75     | 0.741 | 0.790  | 843.00  | 625      | 791.00   | 625.00   | 53       | 42           | 6.67%                 |          |
| 0.70     | 0.692 | 0.741  | 940.00  | 650      | 877.00   | 650.00   | 63       | 46           | 7.14%                 |          |
| 中网     | 0.70  | 0.692  | 0.840   | 940.00   | 650      | 774.00   | 650.00   | 166          | 139                   | 21.43%   |
| 大网     | 0.70  | 0.692  | 0.988   | 940.00   | 650      | 658.00   | 650.00   | 282          | 279                   | 42.86%   |
| 小网     | 0.65  | 0.642  | 0.692   | 1051.00  | 675      | 976.00   | 675.00   | 75           | 52                    | 7.69%    |
| 0.60     | 0.593 | 0.642  | 1181.00 | 700      | 1090.00  | 700.00   | 91       | 58           | 8.33%                 |          |
| 0.55     | 0.543 | 0.593  | 1334.00 | 725      | 1223.00  | 725.00   | 111      | 66           | 9.09%                 |          |
| 中网     | 0.55  | 0.543  | 0.692   | 1334.00  | 725      | 1048.00  | 725.00   | 286          | 198                   | 27.27%   |
| 小网     | 0.50  | 0.494  | 0.543   | 1518.00  | 750      | 1380.00  | 750.00   | 138          | 75                    | 10.00%   |
| 0.45     | 0.445 | 0.494  | 1743.00 | 775      | 1569.00  | 775.00   | 174      | 86           | 11.11%                |          |
| 0.40     | 0.395 | 0.445  | 2024.00 | 800      | 1799.00  | 800.00   | 225      | 100          | 12.50%                |          |
| 中网     | 0.40  | 0.395  | 0.543   | 2024.00  | 800      | 1472.00  | 800.00   | 552          | 300                   | 37.50%   |
| 大网     | 0.40  | 0.395  | 0.692   | 2024.00  | 800      | 1157.00  | 800.00   | 868          | 600                   | 75.00%   |
| 超大网   | 0.40  | 0.395  | 0.988   | 2024.00  | 800      | 810.00   | 800.00   | 1215         | 1200                  | 150.00%  |
| 压力测试 |       |        |         |          | 12650.00 |          |          |              |                       |          |

 

![Alt](https://user-images.githubusercontent.com/35519242/116804691-557fb480-ab53-11eb-9ea8-26723c77312d.png)

