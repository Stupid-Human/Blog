---
layout: post

title: 网格交易介绍&表格设计

date: 2020-08-31

categories: 投资系统打造

tags: [理财]

description:   

---


[toc]

## motivation

### why

为什么需要掌握网格交易方法，按照e大的说法，资本市场整体走势就3个状态，震荡、上涨、下跌。根据《股市长线法宝》一书的数据，尽管美股两百年来股票指数长期涨幅巨大，但是聚焦到中间的10-30年，则发现可能几十年不涨。**我们做投资，要做到不预测只应对**，因此e大建议**一个成熟的投资操作体系必须要有长期策略及短期策略**，长期策略是用来赚增长+通胀的大钱，短期波段策略赚的是情绪以及波动的钱，保护心态。

### what

网格交易，或者叫波段操作，吃的就是震荡行情的利润。

### how

按照经验，可以把资产70%的仓位用来配置长线，10%-20%用来配置网格交易。网格仓位和长线仓位要分开单独配置。



## Pro

下面原汁原味的e大的网格交易策略系列文章，它们无论是从文笔还是水平来说，都属顶流，建议读几遍，我就不做任何解读了。

[波段策略.网格之一：写在前面、体系以及策略](https://mp.weixin.qq.com/s/uxktt5ZpNo03FpQQX-aG7g)

[波段策略.网格之二：网格策略基础/1.0版](https://mp.weixin.qq.com/s/-czfqGvxkDcay_tSI1jv5g)

[波段策略.网格之三：网格策略进阶/2.0版](https://mp.weixin.qq.com/s?__biz=MzIwMTIzNDMwNA==&mid=2653409191&idx=1&sn=5c305c5cf5237e8d2c8d8f7bf0320654&chksm=8d226d48ba55e45e96029083b5656d0c494a10c9c39cff79032ec0667157f36165d47be65957&scene=21#wechat_redirect)

[网格交易细节说明（2020.04.29更新）](https://mp.weixin.qq.com/s/iIOXZCZNCaWwY_PyXUkOEw)



其中，压力测试是最重要的，也就是说，极限跌幅务必得考虑好，参考文章[**长赢计划发车文章中的“预计最大跌幅”是如何得出呢？**](https://content.qieman.com/items/325)

> 极限跌幅的判断依据基本上来讲有四条，其中两条价值、一条价格、一条投资原则：
>
> 价值历史纵向：A股历史上，该指数最低估值。 这个估值包括PE、PB、PS等数据。 通过各数据与目前估值数据对比，大致得出即使出现2008年那样的金融危机，该指数从最极限估值角度讲，会有多少下跌幅度。
>
> 价值世界横向：将世界各国，尤其是美国与各指数类似的指数历史最低估值，与目前各指数估值对比，得出大致的极限下跌空间。
>
> 价格：不会死的投资品种，通常来讲，从最高点到最低点，跌幅几乎不会超过80%，尤其是各国的宽基股票指数。你在下跌80%的时候买，即使短期依然会套，中长期将会赚非常多。
>
> 风险承受能力：在正常的最大跌幅上再加一点余量，**力求让各位能尽量考虑风险多过考虑收益。 这是金融投资中非常重要的一点。**

**历史上几次最著名的暴跌**：

> 1989年底，日经225指数在连涨15年，从3700点涨到38957点后，开始暴跌，最低跌到2003年的7600点，下跌80%。 跌到只剩20%。 2000年，纳斯达克指数连涨20多年，从70多点涨到5100点后，暴跌三年，跌到1100点，下跌78%。 跌到还剩22%。 07年恒生最高31958，08年最低10676。 下跌67%，还剩33%。 再看大A。 深综指在2008年初最高到1584，最低跌到452点，下跌71%，还剩29%。 再看原油。 NY油价是2013年涨到最高112开始崩盘。 最低点是26块，下跌77%，还剩23%。 再看汇率。 英镑/美元从1980年的2.45跌到1985年的1.05，下跌幅度是57%，还剩43%。 美元/日元是从1982年的277跌到2011年的75，跌幅73%，还剩27%。 最后看白银。 之所以用白银不用黄金，是因为历史上白银价格波动远大于黄金。 白银最大一次跌幅出现在80年代，从最高点49美元跌到最低3.7，跌幅达到了92%。 这个跌幅已经超过了我们之前说的80%。 这里有两个原因，第一个原因是80年涨的太疯狂。 白银从1972年的1.7涨到1980年的49，8年时间涨了28倍。 如果从49算起，那么下跌80%应该是9.8。 如果在9.8买入，跌到3.7当然会浮亏不少，但是到2011年，即使9.8买入，也会赚400%。



## code & excel

指数估值表——来源于e大微博

![Alt](https://user-images.githubusercontent.com/35519242/116804651-f91c9500-ab52-11eb-9f23-dc0389ee595a.jpg)

![Alt](https://user-images.githubusercontent.com/35519242/116804672-28cb9d00-ab53-11eb-8c61-b43052d4e17b.png)

我准备把军工拿来试水，参考蛋卷基金的[中证军工的估值](https://danjuanapp.com/dj-valuation-table-detail/SZ399967)，军工估值已经跌落到平均值以下了，可以入手。对于极限跌幅，从e大的估值表来看，军工历史上最低估值是约2008年的19倍，现在PE估值49倍，极限跌幅可以给到60%，这就是压力测试了。

本交易设计参考e大的2.0版本，融合了**留利润、逐格加码及大中小网结合**的子策略。3.0版本可以更进一步，比如考虑趋势交易，暂时不碰了。

我用Python3写了一小段代码来辅助设计表格，其中，start、moneyEach、ratio均可修改。代码运行完后把输出结果复制粘贴到excel表格相应位置即可。

有了表格以后，添加华宝的条件交易单，



```
# 网格交易计算 
'''
    融合了留利润、逐格加码及大中小网结合的子策略，可以根据需要修改代码。
    同时，买入数量为了保证为100的整数倍，稍微处理了一下。
    start、money、ratio均可修改
    
    把输出结果复制粘贴到excel相应位置即可(全选输出结果，然后粘贴到excel的C3即可)。
    可以把代码进一步修改，直接生成表格，但是我不想花时间了，因pandas用得不是很6。
'''
import pandas 

start = 0.988  # 0.988 从某个价格下跌5%时买入第一网，这个价格可以是当前价格，或者比当前价格高或者低。别在均值以上高位买入。
money = 10000 # 每份金额 
num = 0
ratio = 0.05  #小网格每网的大小
baseList = []  # 存每一格的买入价格。
print('买入价',   '卖出价', '买入数量',  '买入金额', '卖出数量', '卖出金额',
          '本期留存数量',  '本期留存利润/盈利金额', '盈利比例')

def PRINT(lastNetCostprice, base, N, moneyEach):
    # N为radio的1、3、6、12倍
    costpriceIn = base
    costpriceOut = lastNetCostprice
    
    NumInTmp = moneyEach / costpriceIn 
    if NumInTmp % 100 == 0:
        NumIn = NumInTmp
    else: 
        # 单独处理一下“买入数量不为100的整数倍”的情况，补齐。
        NumIn = NumInTmp + (100 - NumInTmp % 100)
        
    moneyIn = costpriceIn * NumIn
    moneyOut = moneyIn  # 买卖金额一样，留利润
    
    NumOut = moneyIn / costpriceOut
    Numkeep = NumIn - NumOut 
    profitKeep = costpriceOut * Numkeep
    profitRatio = profitKeep / moneyEach 
    
    print('%.3f' % costpriceIn, '\t',
             '%.3f' % costpriceOut, '\t',
             '%.0f' % NumIn, '\t',
             '%.0f' % moneyIn, '\t',
             '%.0f' % NumOut, '\t',
             '%.0f' % moneyOut, '\t', 
             '%.0f' % Numkeep, '\t',
             '%.0f' % profitKeep, '\t',
             '{:.2%}'.format(profitRatio)) 

for i in range(13):
    if i != 0:
        num += 1
    base = start * (1-ratio*num)  #base为当前这一网的买入价
    baseList.append(base)
    moneyEach = money*(1+ratio*i)    # 逐格加码
    if i == 0:
        lastNetCostprice = base * (1+ratio)
    else: 
        lastNetCostprice = baseList[i-1]
    
    # 小网
    # lastNetCostprice为上一网的价格，中网、大网、超大网则不是。
    PRINT(lastNetCostprice, base, 1, moneyEach)
    
    # 中网 大网 超大网
    if num % 3 == 0 and i != 0:
        PRINT(baseList[i-3], base, 3, moneyEach)
    if num % 6 == 0 and i != 0:
        PRINT(baseList[i-6], base, 6, moneyEach)
    if num % 12 == 0 and i != 0:
        PRINT(baseList[i-12], base, 12, moneyEach)
```



**小网5%，中网15%，大网30%，超大网60%操作表**

| 种类     | 档位  | 买入价 | 卖出价   | 买入数量 | 买入金额  | 卖出数量 | 卖出金额 | 本期留存数量 | 本期留存利润/盈利金额 | 盈利比例 |
| -------- | ----- | ------ | -------- | -------- | --------- | -------- | -------- | ------------ | --------------------- | -------- |
| 小网     | 1.00  | 0.988  | 1.037    | 10200.00 | 10078     | 9714.00  | 10078    | 486          | 504                   | 5.04%    |
| 0.95     | 0.939 | 0.988  | 11200.00 | 10512    | 10640.00  | 10512    | 560      | 553          | 5.27%                 |          |
| 0.90     | 0.889 | 0.939  | 12400.00 | 11026    | 11747.00  | 11026    | 653      | 613          | 5.57%                 |          |
| 0.85     | 0.840 | 0.889  | 13700.00 | 11505    | 12939.00  | 11505    | 761      | 677          | 5.89%                 |          |
| 中网     | 0.85  | 0.840  | 0.988    | 13700.00 | 11505     | 11645.00 | 11505    | 2055         | 2030                  | 17.66%   |
| 小网     | 0.80  | 0.790  | 0.840    | 15200.00 | 12014     | 14306.00 | 12014    | 894          | 751                   | 6.26%    |
| 0.75     | 0.741 | 0.790  | 16900.00 | 12523    | 15844.00  | 12523    | 1056     | 835          | 6.68%                 |          |
| 0.70     | 0.692 | 0.741  | 18800.00 | 13002    | 17547.00  | 13002    | 1253     | 929          | 7.14%                 |          |
| 中网     | 0.70  | 0.692  | 0.840    | 18800.00 | 13002     | 15482.00 | 13002    | 3318         | 2786                  | 21.43%   |
| 大网     | 0.70  | 0.692  | 0.988    | 18800.00 | 13002     | 13160.00 | 13002    | 5640         | 5572                  | 42.86%   |
| 小网     | 0.65  | 0.642  | 0.692    | 21100.00 | 13550     | 19593.00 | 13550    | 1507         | 1042                  | 7.72%    |
| 0.60     | 0.593 | 0.642  | 23700.00 | 14049    | 21877.00  | 14049    | 1823     | 1171         | 8.36%                 |          |
| 0.55     | 0.543 | 0.593  | 26700.00 | 14509    | 24475.00  | 14509    | 2225     | 1319         | 9.10%                 |          |
| 中网     | 0.55  | 0.543  | 0.692    | 26700.00 | 14509     | 20979.00 | 14509    | 5721         | 3957                  | 27.29%   |
| 小网     | 0.50  | 0.494  | 0.543    | 30400.00 | 15018     | 27636.00 | 15018    | 2764         | 1502                  | 10.01%   |
| 0.45     | 0.445 | 0.494  | 34900.00 | 15517    | 31410.00  | 15517    | 3490     | 1724         | 11.12%                |          |
| 0.40     | 0.395 | 0.445  | 40500.00 | 16006    | 36000.00  | 16006    | 4500     | 2001         | 12.50%                |          |
| 中网     | 0.40  | 0.395  | 0.543    | 40500.00 | 16006     | 29455.00 | 16006    | 11045        | 6002                  | 37.51%   |
| 大网     | 0.40  | 0.395  | 0.692    | 40500.00 | 16006     | 23143.00 | 16006    | 17357        | 12004                 | 75.03%   |
| 超大网   | 0.40  | 0.395  | 0.988    | 40500.00 | 16006     | 16200.00 | 16006    | 24300        | 24008                 | 150.05%  |
| 压力测试 |       |        |          |          | 253339.00 |          |          |              |                       |          |



表格如下

![Alt](https://user-images.githubusercontent.com/35519242/116806200-01c69880-ab5e-11eb-8254-f471d8685987.png)

